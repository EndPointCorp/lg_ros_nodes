<!DOCTYPE html>
<html>

<head>
<script type="text/javascript" src="js/util.js"></script>
<style>
body {
  background-color: black;
  height: 100%;
  width: 100%;
  margin: 0;
  overflow: hidden;
}
#stream, img {
  pointer-events: none;
  user-select: none;
}
</style>
</head>

<body>
<div id="stream"></div>
<script type="text/javascript">
// disable context menu
document.addEventListener('contextmenu', function(e) {
  e.preventDefault();
}, false);

var streamDiv = document.getElementById('stream');

var webVideoServerUri = getParameterByName('web_video_server', String, 'http://localhost:8080');
var viewport = getParameterByName('played_back_viewport', String);
if (!viewport) {
  console.error('Must specify viewport param');
}

// Must match the form of lg_mirror.utils.get_viewport_base_topic()
// ros_compressed stream type will append /compressed
var streamTopic = '/lg_mirror/viewport/' + viewport;
var streamUrl = webVideoServerUri + '/stream?type=ros_compressed&topic=' + streamTopic;

var img = document.createElement('img');
img.onload = function(ev) {
  console.log('load at', ev.timeStamp, 'ms');
  window.postMessage({ type: "DIRECTOR_WINDOW_READY" }, "*");
  // TODO (WZ)
  // - wait for message on /director/ready (lg_common/Ready)
  // - check if your ros_instance_name was on the `instances` list in the message
  // - as soon as the the message comes on the topic - get ready by waiting 1
  // seconds (or wait GET arg amount of seconds) to get rid of the previous scene
  // in the playback stream
  setTimeout(function(){
      streamDiv.appendChild(img);
  }, 3000);
}


img.src = streamUrl;



</script>
</body>

</html>
